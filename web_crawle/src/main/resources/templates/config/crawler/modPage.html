<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="common/header::head('爬虫配置','/bootstrap/css/bootstrap-table.css','/bootstrap/js/bootstrap-table.js,/bootstrap/js/bootstrap-table-zh-CN.min.js,/js/com/sql-formatter.min.js,/js/config/crawler.page.exc.js')"></head>
<script type="text/javascript">
	$(function(){
		var actionType=['/crawle/config/add','/crawle/config/modfiy']
		var defiend_page={
				btn_ele:"#btn_crawle_add_excute",
				table_ele:".table-defined",
				attr_ele:"#table-attr-content .table-attr-column"
			}
		$("#btn_crawl_add_submit").click(function(){
			var data=getConfigData(defiend_page)
			if(data){
				var flag=$(this).parents(".panel-heading").children("h4").attr("flag")
				if(flag==undefined){
					flag=0;
				}
				$.doPostJsonAjax({
					url:actionType[flag],
					data:JSON.stringify(data),
					type:"post",
					success:function(res){
						if(res.success){
							$.cartPage().back();
							$.alert({type:"success",content:"操作成功"});
						}
					}
				})
			}
		})
		//执行爬虫按钮事件
		btnExcete(defiend_page);
		
		$("#btn-table-attr-add").on("click",function(){
			var mid=$("#myTab").find(".active").children("a").attr("href");
			$(mid).append(addTableAttrPanel(mid))
		})
		
		$("body").on("click",".table-attr-column-minus",function(){
			$(this).parents(".table-attr-column").remove()
		})
	})
	
	function addTableAttrPanel(node){
		return $(node).find(".table-attr-column-clone").clone().removeClass("table-attr-column-clone").removeClass("hidden").addClass("table-attr-column")
	}
</script>
<style type="text/css">
	.tab-three .pull-left{width: 32%}
	.tab-second .pull-left{width: 49%}
	.table-titile>label {text-align: center; height: 20px; line-height: 20px}
	.table-attr-column{padding: 2px 0px}
	.table-attr-column .pull-left{text-align: center;height: 20px;line-height: 20px;}
	.table-attr-column input,select {width: 98%;padding: 0 1%;}
	#btn-table-attr-add{position: absolute; top: calc(50% - 10px); right: 5px}
	.table-defined div:first-child {width: 40%}
	.table_remark{width:60%; height: 100%;padding-left: 30px;}
	.table_remark span{position: absolute; top:8px;width: 9%;text-align: right;}
	.table_remark>textarea{width: 90%; margin-left: 10%;  height: 34px;}
	.table-attr-column  textarea{height: 25px;}
	.w_33{width: 30%;padding-right: 3.3%}
</style>
<body>
	<div id="page-panel" class="panel panel-default fade in">
		<div class="panel-heading clearfix">
			<h4 class="pull-left" th:if="${type==0}" th:attr="flag=${type}">爬虫配置新增</h4>
			<h4 class="pull-left" th:if="${type==1}" th:attr="flag=${type}">爬虫配置编辑</h4>
			<div class="page-tool pull-right">
					<button class="btn btn-primary" id="btn_crawle_add_excute">执行</button>
					<button class="btn btn-primary" id="btn_crawl_add_submit">提交</button>
			</div> 
		</div>
		<div id="page-contain" class="panel-body">
			<div class="panel panel-default ">
				<div class="panel table-defined pos_relative">
					<div class="input-group pull-left"><label  class="input-group-addon">名称</label><input class="form-control" placeholder="表名称"  name="name" th:value="${config==null}?'':${config.name}" type="text" require="true" /></div>
					<div class="input-group table_remark"><span  >描述</span><textarea   name="remark" th:text="${config==null}?'':${config.remark}"></textarea></div>
					<div class="input-group">	<label class="input-group-addon">类型</label>
						<div class="pull-left"><input checked="checked" type="radio" name="type" value="html"/><label>html</label></div>
						<div><input type="radio" name="type" value="json"/><label>json</label></div>
					</div>
					<div class="input-group w_33 pull-left">	<label class="input-group-addon">迭代数</label><input class="form-control" placeholder="迭代数"  name="name" th:value="${config==null}?'':${config.depth}" type="number" require="true" /></div>
					<div class="input-group w_33 pull-left">	<label class="input-group-addon">topN</label><input class="form-control" placeholder="topN"  name="name" th:value="${config==null}?'':${config.topN}" type="number" require="true" /></div>
					<div class="input-group w_33 pull-left">	<label class="input-group-addon">线程数</label><input class="form-control" placeholder="线程数"  name="name" th:value="${config==null}?'':${config.threads}" type="number" require="true" /></div>
					<div class="input-group" style="width: 100%;"><textarea name="jsContent" style="width: 100%; height: 200px"></textarea></div>
				</div>
				<div class="panel">
					<div class="title-header clearfix pos_relative">
						<div class="clearfix table-titile ">
							<ul id="myTab" class="nav nav-tabs">
							    <li class="active">
							        <a href="#crawler-url_content" data-toggle="tab">种子路径   </a>
							    </li>
							    <li ><a href="#crawler-filter-content" data-toggle="tab">爬取过滤</a></li>
							</ul>
						</div>
						<span class="glyphicon glyphicon-plus" id="btn-table-attr-add"></span>
					</div>
					<div id="table-attr-content" class="tab-content">
						<div id="crawler-url_content" class="tab-pane fade in active tab-three" field="urls">
							<div class="clearfix table-titile">
								<label class="pull-left">名称</label><label class="pull-left">url</label><label class="pull-left">条件</label>
							</div>
							<div class="clearfix table-attr-column-clone hidden">
								<div class="pull-left"><input name="name" type="text" placeholder="名称"/></div>
								<div class="pull-left"><input name="url" type="url" placeholder="url"/></div>
								<div class="pull-left"><textarea name="condtion" placeholder="条件"></textarea></div>
								<div class="pull-right"><span class="glyphicon glyphicon-minus table-attr-column-minus"></span></div>
							</div>
							<div class="clearfix table-attr-column" th:each="item,stats:${config==null}?null:${config.urls}">
								<div class="pull-left"><input name="name" type="text" placeholder="名称" th:value="${item.name}"/></div>
								<div class="pull-left"><input name="url" type="url" placeholder="url" th:value="${item.url}"/></div>
								<div class="pull-left"><textarea name="condtion" placeholder="条件" th:value="${item.condtion}"></textarea></div>
								<div class="pull-right"><span class="glyphicon glyphicon-minus table-attr-column-minus"></span></div>
							</div>
						</div>
						<div id="crawler-filter-content"  class="tab-pane fade in tab-second" field="filters">
							<div class="clearfix table-titile">
								<label class="pull-left">名称</label><label class="pull-left">条件</label>
							</div>
							<div class="clearfix table-attr-column-clone hidden">
								<div class="pull-left"><input name="name" type="text" placeholder="名称"/></div>
								<div class="pull-left"><textarea name="value" placeholder="条件"></textarea></div>
								<div class="pull-right"><span class="glyphicon glyphicon-minus table-attr-column-minus"></span></div>
							</div>
							<div class="clearfix table-attr-column" th:each="item,stats:${config==null}?null:${config.filters}">
								<div class="pull-left"><input name="name" type="text" placeholder="名称" th:value="${item.name}"/></div>
								<div class="pull-left"><textarea name="value" placeholder="条件" th:value="${item.value}"></textarea></div>
								<div class="pull-right"><span class="glyphicon glyphicon-minus table-attr-column-minus"></span></div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>
</html>
